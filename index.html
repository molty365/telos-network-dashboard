<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Telos Network Dashboard</title>
<script src="https://cdn.ethers.io/lib/ethers-5.7.2.umd.min.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--cyan:#00F2FE;--blue:#4FACFE;--purple:#C471F5;--bg:#0a0a14;--card:#12121f;--card-border:#1a1a2e;--text:#e0e0e0;--text-dim:#7a7a9a;--glow:rgba(0,242,254,0.15)}
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap');
body{font-family:'Inter',sans-serif;background:var(--bg);color:var(--text);overflow-x:hidden;min-height:100vh}
a{color:var(--cyan);text-decoration:none}

/* Header */
header{display:flex;align-items:center;justify-content:space-between;padding:16px 40px;border-bottom:1px solid var(--card-border);backdrop-filter:blur(20px);position:sticky;top:0;z-index:100;background:rgba(10,10,20,0.85)}
.logo{font-size:28px;font-weight:700;background:linear-gradient(135deg,var(--cyan),var(--blue),var(--purple));-webkit-background-clip:text;-webkit-text-fill-color:transparent;letter-spacing:2px;text-transform:lowercase}
nav{display:flex;gap:8px}
nav a{padding:8px 20px;border-radius:20px;font-size:14px;font-weight:500;color:var(--text-dim);transition:all .3s}
nav a:hover,nav a.active{background:rgba(79,172,254,0.15);color:var(--blue)}
.network-badge{font-size:12px;padding:6px 14px;border-radius:14px;border:1px solid var(--card-border);color:var(--cyan);display:flex;align-items:center;gap:6px}
.network-badge::before{content:'';width:6px;height:6px;border-radius:50%;background:var(--cyan);box-shadow:0 0 8px var(--cyan);animation:pulse 2s infinite}

/* Globe Hero */
.hero{position:relative;height:420px;display:flex;align-items:center;justify-content:center;overflow:hidden}
#globe-canvas{position:absolute;top:0;left:0;width:100%;height:100%}
.hero-overlay{position:absolute;bottom:0;left:0;right:0;height:120px;background:linear-gradient(transparent,var(--bg));pointer-events:none}

/* Stats Grid */
.dashboard{max-width:1280px;margin:0 auto;padding:0 24px 60px}
.section-row{display:grid;gap:16px;margin-bottom:16px}
.row-2{grid-template-columns:1fr 1fr}
.row-3{grid-template-columns:1fr 1fr 1fr}

/* Cards */
.card{background:var(--card);border:1px solid var(--card-border);border-radius:14px;padding:20px 24px;position:relative;overflow:hidden;transition:border-color .3s,box-shadow .3s}
.card:hover{border-color:rgba(79,172,254,0.3);box-shadow:0 0 30px rgba(79,172,254,0.08)}
.card-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
.card-title{font-size:13px;font-weight:500;color:var(--text-dim);text-transform:uppercase;letter-spacing:1px}
.card-badge{font-size:10px;padding:3px 10px;border-radius:10px;background:rgba(0,242,254,0.1);color:var(--cyan);font-weight:500;display:flex;align-items:center;gap:4px}
.card-badge::before{content:'';width:5px;height:5px;border-radius:50%;background:var(--cyan);animation:pulse 2s infinite}
.card-body{display:flex;align-items:flex-end;justify-content:space-between;gap:16px}
.card-value{font-family:'JetBrains Mono',monospace;font-size:32px;font-weight:500;line-height:1}
.card-unit{font-size:14px;color:var(--text-dim);margin-left:4px;font-weight:400}
.sparkline{flex-shrink:0}
.sparkline canvas{display:block}

/* Recent Blocks */
.blocks-list{display:flex;flex-direction:column;gap:8px;max-height:260px;overflow-y:auto}
.block-row{display:flex;justify-content:space-between;align-items:center;padding:10px 14px;background:rgba(255,255,255,0.02);border-radius:8px;font-family:'JetBrains Mono',monospace;font-size:13px;transition:background .2s}
.block-row:hover{background:rgba(79,172,254,0.06)}
.block-num{color:var(--cyan)}
.block-txs{color:var(--text-dim)}
.block-time{color:var(--text-dim);font-size:11px}

/* Loading */
.loading{color:var(--text-dim);font-size:14px;animation:fade 1.5s infinite alternate}

/* Footer */
footer{text-align:center;padding:30px;color:var(--text-dim);font-size:12px;border-top:1px solid var(--card-border)}

/* Animations */
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.4}}
@keyframes fade{0%{opacity:.3}100%{opacity:1}}
@keyframes glow-shift{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}

/* Value colors */
.val-cyan{color:var(--cyan)}
.val-blue{color:var(--blue)}
.val-purple{color:var(--purple)}
.val-gradient{background:linear-gradient(135deg,var(--cyan),var(--blue));-webkit-background-clip:text;-webkit-text-fill-color:transparent}

/* Responsive */
@media(max-width:768px){
  header{padding:12px 16px;flex-wrap:wrap;gap:8px}
  .hero{height:280px}
  .row-2,.row-3{grid-template-columns:1fr}
  .dashboard{padding:0 12px 40px}
  .card-value{font-size:24px}
}
</style>
</head>
<body>

<header>
  <div class="logo">telos</div>
  <nav>
    <a href="#" class="active">Home</a>
    <a href="#">Validators</a>
    <a href="#">Charts</a>
  </nav>
  <div class="network-badge">Mainnet</div>
</header>

<section class="hero">
  <canvas id="globe-canvas"></canvas>
  <div class="hero-overlay"></div>
</section>

<main class="dashboard">
  <!-- Row 1: TPS + Recent Blocks -->
  <div class="section-row row-2">
    <div class="card">
      <div class="card-header">
        <span class="card-title">TPS</span>
        <span class="card-badge">Live</span>
      </div>
      <div class="card-body">
        <div><span class="card-value val-cyan" id="tps">—</span><span class="card-unit">tx/s</span></div>
        <div class="sparkline"><canvas id="spark-tps" width="120" height="40"></canvas></div>
      </div>
    </div>
    <div class="card">
      <div class="card-header">
        <span class="card-title">Recent Blocks</span>
        <span class="card-badge">Live</span>
      </div>
      <div id="recent-blocks" class="blocks-list"><div class="loading">Loading blocks...</div></div>
    </div>
  </div>

  <!-- Row 2: Block Time, Gas Price, Peak TPS -->
  <div class="section-row row-3">
    <div class="card">
      <div class="card-header">
        <span class="card-title">Block Time</span>
        <span class="card-badge">Live</span>
      </div>
      <div class="card-body">
        <div><span class="card-value val-blue" id="block-time">—</span><span class="card-unit">ms</span></div>
        <div class="sparkline"><canvas id="spark-bt" width="120" height="40"></canvas></div>
      </div>
    </div>
    <div class="card">
      <div class="card-header">
        <span class="card-title">Gas Price</span>
        <span class="card-badge">Live</span>
      </div>
      <div class="card-body">
        <div><span class="card-value val-purple" id="gas-price">—</span><span class="card-unit">Gwei</span></div>
        <div class="sparkline"><canvas id="spark-gas" width="120" height="40"></canvas></div>
      </div>
    </div>
    <div class="card">
      <div class="card-header">
        <span class="card-title">TLOS Price</span>
        <span class="card-badge">Live</span>
      </div>
      <div class="card-body">
        <div><span class="card-value val-gradient" id="tlos-price">—</span></div>
        <div class="sparkline"><canvas id="spark-price" width="120" height="40"></canvas></div>
      </div>
    </div>
  </div>

  <!-- Row 3: Staked, Market Cap, Validators -->
  <div class="section-row row-3">
    <div class="card">
      <div class="card-header">
        <span class="card-title">Total Staked</span>
        <span class="card-badge">Current</span>
      </div>
      <div class="card-body">
        <div><span class="card-value val-cyan" id="total-staked">—</span><span class="card-unit">TLOS</span></div>
      </div>
    </div>
    <div class="card">
      <div class="card-header">
        <span class="card-title">Market Cap</span>
        <span class="card-badge">Live</span>
      </div>
      <div class="card-body">
        <div><span class="card-value val-blue" id="market-cap">—</span></div>
      </div>
    </div>
    <div class="card">
      <div class="card-header">
        <span class="card-title">Validators</span>
        <span class="card-badge">Current</span>
      </div>
      <div class="card-body">
        <div><span class="card-value val-purple" id="validators">21</span><span class="card-unit">active</span></div>
      </div>
    </div>
  </div>

  <!-- Row 4: APY -->
  <div class="section-row row-3">
    <div class="card">
      <div class="card-header">
        <span class="card-title">Staking APY</span>
        <span class="card-badge">Current</span>
      </div>
      <div class="card-body">
        <div><span class="card-value val-gradient" id="apy">~4.0</span><span class="card-unit">%</span></div>
      </div>
    </div>
  </div>
</main>

<footer>
  telos network dashboard — live on-chain analytics
</footer>

<script>
// ─── Globe Animation ───
(function(){
  const c=document.getElementById('globe-canvas'),ctx=c.getContext('2d');
  let w,h,t=0,points=[];
  function resize(){w=c.width=c.offsetWidth;h=c.height=c.offsetHeight;points=[];for(let i=0;i<200;i++)points.push({lat:Math.random()*Math.PI-Math.PI/2,lon:Math.random()*Math.PI*2,s:Math.random()*1.5+0.5})}
  resize();window.addEventListener('resize',resize);
  function proj(lat,lon){
    const r=Math.min(w,h)*0.32;
    const x=r*Math.cos(lat)*Math.sin(lon+t);
    const z=r*Math.cos(lat)*Math.cos(lon+t);
    const y=r*Math.sin(lat);
    const sc=600/(600+z);
    return{x:w/2+x*sc,y:h/2-y*sc,z,sc};
  }
  function draw(){
    ctx.clearRect(0,0,w,h);
    // Grid lines
    ctx.strokeStyle='rgba(0,242,254,0.06)';ctx.lineWidth=0.5;
    for(let lat=-80;lat<=80;lat+=20){
      ctx.beginPath();
      for(let lon=0;lon<=360;lon+=4){const p=proj(lat*Math.PI/180,lon*Math.PI/180);if(lon===0)ctx.moveTo(p.x,p.y);else if(p.z>-100)ctx.lineTo(p.x,p.y)}
      ctx.stroke();
    }
    for(let lon=0;lon<360;lon+=30){
      ctx.beginPath();
      for(let lat=-90;lat<=90;lat+=4){const p=proj(lat*Math.PI/180,lon*Math.PI/180);if(lat===-90)ctx.moveTo(p.x,p.y);else if(p.z>-100)ctx.lineTo(p.x,p.y)}
      ctx.stroke();
    }
    // Points
    points.forEach(pt=>{
      const p=proj(pt.lat,pt.lon);
      if(p.z>-50){
        const a=Math.max(0,(p.z+200)/400);
        ctx.beginPath();ctx.arc(p.x,p.y,pt.s*p.sc,0,Math.PI*2);
        ctx.fillStyle=`rgba(79,172,254,${a*0.7})`;ctx.fill();
      }
    });
    // Connection lines
    for(let i=0;i<points.length;i+=3){
      const j=(i+7)%points.length;
      const a=proj(points[i].lat,points[i].lon),b=proj(points[j].lat,points[j].lon);
      if(a.z>0&&b.z>0){
        const d=Math.hypot(a.x-b.x,a.y-b.y);
        if(d<150){
          ctx.beginPath();ctx.moveTo(a.x,a.y);ctx.lineTo(b.x,b.y);
          ctx.strokeStyle=`rgba(196,113,245,${0.12*(1-d/150)})`;ctx.lineWidth=0.5;ctx.stroke();
        }
      }
    }
    // Outer ring glow
    const r=Math.min(w,h)*0.33;
    const g=ctx.createRadialGradient(w/2,h/2,r*0.9,w/2,h/2,r*1.1);
    g.addColorStop(0,'rgba(0,242,254,0.03)');g.addColorStop(0.5,'rgba(79,172,254,0.02)');g.addColorStop(1,'transparent');
    ctx.fillStyle=g;ctx.fillRect(0,0,w,h);
    t+=0.003;requestAnimationFrame(draw);
  }
  draw();
})();

// ─── Sparkline Drawing ───
const sparkData={tps:[],bt:[],gas:[],price:[]};
function drawSparkline(canvasId,data,color){
  const c=document.getElementById(canvasId);if(!c||data.length<2)return;
  const ctx=c.getContext('2d'),w=c.width,h=c.height;
  ctx.clearRect(0,0,w,h);
  const min=Math.min(...data),max=Math.max(...data),range=max-min||1;
  ctx.beginPath();
  data.forEach((v,i)=>{
    const x=(i/(data.length-1))*w,y=h-((v-min)/range)*(h-4)-2;
    i===0?ctx.moveTo(x,y):ctx.lineTo(x,y);
  });
  ctx.strokeStyle=color;ctx.lineWidth=1.5;ctx.stroke();
  // Fill gradient
  const last=data.length-1;
  ctx.lineTo((last/(data.length-1))*w,h);ctx.lineTo(0,h);ctx.closePath();
  const g=ctx.createLinearGradient(0,0,0,h);
  g.addColorStop(0,color.replace(')',',0.2)').replace('rgb','rgba'));
  g.addColorStop(1,'transparent');
  ctx.fillStyle=g;ctx.fill();
}

// ─── Data Fetching ───
const RPC='https://mainnet.telos.net/evm';
const provider=new ethers.providers.JsonRpcProvider(RPC);

function fmt(n,d=1){
  if(n>=1e9)return(n/1e9).toFixed(d)+'B';
  if(n>=1e6)return(n/1e6).toFixed(d)+'M';
  if(n>=1e3)return(n/1e3).toFixed(d)+'K';
  return n.toFixed(d);
}

async function fetchTPS(){
  try{
    const bn=await provider.getBlockNumber();
    const [b1,b2]=await Promise.all([provider.getBlock(bn),provider.getBlock(bn-10)]);
    const dt=b1.timestamp-b2.timestamp;
    const txs=await Promise.all(Array.from({length:10},(_,i)=>provider.getBlock(bn-i).then(b=>b.transactions.length)));
    const totalTx=txs.reduce((a,b)=>a+b,0);
    const tps=dt>0?(totalTx/dt):0;
    document.getElementById('tps').textContent=tps.toFixed(1);
    sparkData.tps.push(tps);if(sparkData.tps.length>30)sparkData.tps.shift();
    drawSparkline('spark-tps',sparkData.tps,'rgb(0,242,254)');
    // Block time
    const bt=((b1.timestamp-b2.timestamp)/10)*1000;
    document.getElementById('block-time').textContent=Math.round(bt);
    sparkData.bt.push(bt);if(sparkData.bt.length>30)sparkData.bt.shift();
    drawSparkline('spark-bt',sparkData.bt,'rgb(79,172,254)');
  }catch(e){console.error('TPS error',e)}
}

async function fetchGasPrice(){
  try{
    const gp=await provider.getGasPrice();
    const gwei=parseFloat(ethers.utils.formatUnits(gp,'gwei'));
    document.getElementById('gas-price').textContent=gwei.toFixed(0);
    sparkData.gas.push(gwei);if(sparkData.gas.length>30)sparkData.gas.shift();
    drawSparkline('spark-gas',sparkData.gas,'rgb(196,113,245)');
  }catch(e){console.error('Gas error',e)}
}

async function fetchPrice(){
  try{
    const r=await fetch('https://api.coingecko.com/api/v3/simple/price?ids=telos&vs_currencies=usd&include_market_cap=true');
    const d=await r.json();
    const price=d.telos.usd;
    const mcap=d.telos.usd_market_cap;
    document.getElementById('tlos-price').textContent='$'+price.toFixed(4);
    document.getElementById('market-cap').textContent='$'+fmt(mcap);
    sparkData.price.push(price);if(sparkData.price.length>30)sparkData.price.shift();
    drawSparkline('spark-price',sparkData.price,'rgb(79,172,254)');
  }catch(e){console.error('Price error',e)}
}

async function fetchStaked(){
  try{
    const abi=['function totalAssets() view returns (uint256)'];
    const c=new ethers.Contract('0xB4B01216a5Bc8F1C8A33CD990A1239030E60C905',abi,provider);
    const total=await c.totalAssets();
    const val=parseFloat(ethers.utils.formatEther(total));
    document.getElementById('total-staked').textContent=fmt(val,2);
  }catch(e){console.error('Staked error',e)}
}

async function fetchBlocks(){
  try{
    const bn=await provider.getBlockNumber();
    const blocks=await Promise.all(Array.from({length:6},(_,i)=>provider.getBlock(bn-i)));
    const el=document.getElementById('recent-blocks');
    el.innerHTML=blocks.map(b=>`<div class="block-row"><span class="block-num">#${b.number.toLocaleString()}</span><span class="block-txs">${b.transactions.length} txs</span><span class="block-time">${new Date(b.timestamp*1000).toLocaleTimeString()}</span></div>`).join('');
  }catch(e){console.error('Blocks error',e)}
}

// Init + refresh
async function refresh(){await Promise.allSettled([fetchTPS(),fetchGasPrice(),fetchPrice(),fetchStaked(),fetchBlocks()])}
refresh();
setInterval(refresh,15000);
</script>
</body>
</html>
